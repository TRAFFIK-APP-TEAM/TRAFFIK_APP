<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:TRAFFIK_APP.ViewModels"
             xmlns:models="clr-namespace:TRAFFIK_APP.Models.Dtos.Reward"
             x:Class="TRAFFIK_APP.Views.StaffViewCodesPage"
             x:DataType="vm:StaffViewCodesViewModel"
             Title="Active Codes"
             BackgroundColor="#000000"
             Shell.FlyoutBehavior="Disabled">

    <Grid RowDefinitions="Auto,*">
        <!-- Top Bar -->
        <Grid Padding="24,16" Row="0" BackgroundColor="#000000">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <VerticalStackLayout Spacing="4">
                <Label Text="Active Reward Codes"
                       FontSize="26"
                       FontAttributes="Bold"
                       TextColor="White" />
                <Label Text="View all active redemption codes"
                       FontSize="14"
                       TextColor="#9CA3AF"
                       Opacity="0.7" />
            </VerticalStackLayout>
        </Grid>

        <!-- Main Content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Padding="20" Spacing="16">
                <!-- Refresh Button -->
                <Button Text="Refresh"
                        CornerRadius="8"
                        Command="{Binding RefreshCommand}"
                        BackgroundColor="#1E293B"
                        TextColor="White"
                        BorderWidth="1"
                        BorderColor="#334155"
                        Padding="0,12" />

                <!-- Loading indicator -->
                <ActivityIndicator IsRunning="{Binding IsBusy}" 
                                   IsVisible="{Binding IsBusy}"
                                   Color="#007AFF"
                                   Margin="0,20"/>

                <!-- Empty state -->
                <Border BackgroundColor="#1E1E1E"
                        Stroke="Gray"
                        StrokeThickness="1"
                        Padding="20"
                        IsVisible="{Binding HasNoActiveCodes}"
                        Margin="0,20">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Label Text="No active codes found."
                           TextColor="#9CA3AF"
                           FontSize="14"
                           HorizontalOptions="Center" />
                </Border>

                <CollectionView ItemsSource="{Binding ActiveCodes}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:RedeemedRewardDto">
                            <Border BackgroundColor="#1E1E1E"
                                    Stroke="Gray"
                                    StrokeThickness="1"
                                    Padding="16"
                                    Margin="0,0,0,12">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="12"/>
                                </Border.StrokeShape>
                                <VerticalStackLayout>
                                    <Label Text="{Binding Name}" 
                                           TextColor="White" 
                                           FontSize="18" 
                                           FontAttributes="Bold"/>
                                    <Label Text="{Binding Description}" 
                                           TextColor="#9CA3AF" 
                                           FontSize="14"
                                           Margin="0,4,0,0"/>
                                    <Label Text="{Binding Cost, StringFormat='Cost: {0} points'}" 
                                           TextColor="#666" 
                                           FontSize="12"
                                           Margin="0,8,0,0"/>
                                    
                                    <!-- Redemption Code -->
                                    <Border BackgroundColor="#007AFF"
                                            Stroke="#007AFF"
                                            StrokeThickness="0"
                                            Padding="12,10"
                                            Margin="0,10,0,0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="8"/>
                                        </Border.StrokeShape>
                                        <VerticalStackLayout>
                                            <Label Text="Redemption Code" 
                                                   TextColor="White" 
                                                   FontSize="11" 
                                                   Opacity="0.8"/>
                                            <Label Text="{Binding Code}" 
                                                   TextColor="White" 
                                                   FontSize="20" 
                                                   FontAttributes="Bold"/>
                                        </VerticalStackLayout>
                                    </Border>
                                    
                                    <!-- Status Badge -->
                                    <Border BackgroundColor="#28a745"
                                            Padding="8,4"
                                            Margin="0,8,0,0">
                                        <Border.StrokeShape>
                                            <RoundRectangle CornerRadius="6"/>
                                        </Border.StrokeShape>
                                        <Label Text="Active"
                                               TextColor="White"
                                               FontSize="11"
                                               FontAttributes="Bold"
                                               HorizontalOptions="Center"/>
                                    </Border>
                                    
                                    <Label Text="{Binding RedeemedAt, StringFormat='Redeemed on {0:dd MMM yyyy HH:mm}'}" 
                                           TextColor="#666" 
                                           FontSize="12" 
                                           Margin="0,10,0,0"/>
                                    
                                    <!-- Deactivate Button -->
                                    <Button Text="Deactivate Code"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:StaffViewCodesViewModel}}, Path=DeactivateCodeCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="#DC2626"
                                            TextColor="White"
                                            CornerRadius="8"
                                            Padding="0,12"
                                            Margin="0,10,0,0"/>
                                </VerticalStackLayout>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>
    </Grid>

</ContentPage>

