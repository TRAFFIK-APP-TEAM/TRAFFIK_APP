<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="TRAFFIK_APP.Views.StaffBookingDetailPage"
             BackgroundColor="#000000"
             Shell.FlyoutBehavior="Disabled"
             Shell.NavBarIsVisible="True"
             Title="Booking Details">

    <Grid RowDefinitions="*">
        <!-- Main Content -->
        <ScrollView Grid.Row="0">
            <VerticalStackLayout Padding="20" Spacing="20">
                
                <!-- Booking Info Card -->
                <Border BackgroundColor="#1E1E1E"
                        Stroke="Gray"
                        StrokeThickness="1"
                        Padding="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Grid Padding="16" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" RowSpacing="12">
                        <Label Text="Booking Information"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="White"
                               Grid.Row="0" />
                        
                        <Grid Grid.Row="1" ColumnDefinitions="Auto,*" ColumnSpacing="12">
                            <Label Text="Booking ID:"
                                   TextColor="#9CA3AF"
                                   FontSize="14"
                                   VerticalOptions="Center" />
                            <Label Text="{Binding CurrentBooking.BookingId, StringFormat='#{0}'}"
                                   TextColor="White"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   Grid.Column="1" />
                        </Grid>

                        <Grid Grid.Row="2" ColumnDefinitions="Auto,*" ColumnSpacing="12">
                            <Label Text="Customer:"
                                   TextColor="#9CA3AF"
                                   FontSize="14"
                                   VerticalOptions="Center" />
                            <Label Text="{Binding UserName}"
                                   TextColor="White"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   Grid.Column="1"
                                   LineBreakMode="WordWrap" />
                        </Grid>

                        <Grid Grid.Row="3" ColumnDefinitions="Auto,*" ColumnSpacing="12">
                            <Label Text="Service:"
                                   TextColor="#9CA3AF"
                                   FontSize="14"
                                   VerticalOptions="Center" />
                            <Label Text="{Binding ServiceName}"
                                   TextColor="White"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   Grid.Column="1"
                                   LineBreakMode="WordWrap" />
                        </Grid>

                        <Grid Grid.Row="4" ColumnDefinitions="Auto,*" ColumnSpacing="12">
                            <Label Text="Vehicle:"
                                   TextColor="#9CA3AF"
                                   FontSize="14"
                                   VerticalOptions="Center" />
                            <Label Text="{Binding BookingDetails.VehicleLicensePlate, FallbackValue='N/A'}"
                                   TextColor="White"
                                   FontSize="14"
                                   FontAttributes="Bold"
                                   Grid.Column="1" />
                        </Grid>

                        <Grid Grid.Row="5" ColumnDefinitions="Auto,*" ColumnSpacing="12">
                            <Label Text="Current Status:"
                                   TextColor="#9CA3AF"
                                   FontSize="14"
                                   VerticalOptions="Center" />
                            <Border Grid.Column="1"
                                    BackgroundColor="#007AFF"
                                    Padding="10,5"
                                    HorizontalOptions="Start">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="6"/>
                                </Border.StrokeShape>
                                <Label Text="{Binding CurrentBooking.CurrentStage}"
                                       TextColor="White" />
                            </Border>
                        </Grid>
                    </Grid>
                </Border>

                <!-- Tracking Timeline Card -->
                <Border BackgroundColor="#1E1E1E"
                        Stroke="Gray"
                        StrokeThickness="1"
                        Padding="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Grid Padding="16" RowDefinitions="Auto,Auto" RowSpacing="16">
                        <Label Text="Booking Progress"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="White"
                               Grid.Row="0" />

                        <VerticalStackLayout Grid.Row="1" Spacing="12">
                            <!-- Progress Bar -->
                            <ProgressBar Progress="{Binding Progress}"
                                         ProgressColor="#007AFF"
                                         HeightRequest="12"/>
                            
                            <!-- Stage Timeline -->
                            <VerticalStackLayout Spacing="10">
                                <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto" ColumnDefinitions="Auto,*">
                                    
                                    <!-- Stage 1: Pending -->
                                    <Border Grid.Row="0" Grid.Column="0"
                                            WidthRequest="24"
                                            HeightRequest="24"
                                            BackgroundColor="#007AFF"
                                            StrokeShape="RoundRectangle 12"
                                            Margin="0,0,10,0"/>
                                    <Label Grid.Row="0" Grid.Column="1"
                                           Text="Pending"
                                           FontSize="13"
                                           TextColor="White"
                                           VerticalOptions="Center"/>

                                    <!-- Stage 2: Started -->
                                    <Border Grid.Row="1" Grid.Column="0"
                                            WidthRequest="24"
                                            HeightRequest="24"
                                            BackgroundColor="{Binding Stage2Color}"
                                            StrokeShape="RoundRectangle 12"
                                            Margin="0,0,10,0"/>
                                    <Label Grid.Row="1" Grid.Column="1"
                                           Text="Started"
                                           FontSize="13"
                                           TextColor="White"
                                           VerticalOptions="Center"/>

                                    <!-- Stage 3: Inspection -->
                                    <Border Grid.Row="2" Grid.Column="0"
                                            WidthRequest="24"
                                            HeightRequest="24"
                                            BackgroundColor="{Binding Stage3Color}"
                                            StrokeShape="RoundRectangle 12"
                                            Margin="0,0,10,0"/>
                                    <Label Grid.Row="2" Grid.Column="1"
                                           Text="Inspection"
                                           FontSize="13"
                                           TextColor="White"
                                           VerticalOptions="Center"/>

                                    <!-- Stage 4: Completed -->
                                    <Border Grid.Row="3" Grid.Column="0"
                                            WidthRequest="24"
                                            HeightRequest="24"
                                            BackgroundColor="{Binding Stage4Color}"
                                            StrokeShape="RoundRectangle 12"
                                            Margin="0,0,10,0"/>
                                    <Label Grid.Row="3" Grid.Column="1"
                                           Text="Completed"
                                           FontSize="13"
                                           TextColor="White"
                                           VerticalOptions="Center"/>

                                    <!-- Stage 5: Paid -->
                                    <Border Grid.Row="4" Grid.Column="0"
                                            WidthRequest="24"
                                            HeightRequest="24"
                                            BackgroundColor="{Binding Stage5Color}"
                                            StrokeShape="RoundRectangle 12"
                                            Margin="0,0,10,0"/>
                                    <Label Grid.Row="4" Grid.Column="1"
                                           Text="Paid"
                                           FontSize="13"
                                           TextColor="White"
                                           VerticalOptions="Center"/>
                                </Grid>
                            </VerticalStackLayout>
                        </VerticalStackLayout>
                    </Grid>
                </Border>

                <!-- Update Status Card -->
                <Border BackgroundColor="#1E1E1E"
                        Stroke="Gray"
                        StrokeThickness="1"
                        Padding="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12"/>
                    </Border.StrokeShape>
                    <Border.Shadow>
                        <Shadow Brush="#000000" 
                                Offset="0,4" 
                                Radius="8" 
                                Opacity="0.3"/>
                    </Border.Shadow>
                    <Grid Padding="16" RowDefinitions="Auto,Auto,Auto" RowSpacing="16">
                        <Label Text="Update Status"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="White"
                               Grid.Row="0" />

                        <Label Text="Select the new status for this booking:"
                               FontSize="13"
                               TextColor="#9CA3AF"
                               Margin="0,-10,0,0"
                               Grid.Row="1" />

                        <VerticalStackLayout Grid.Row="2" Spacing="12">
                            <Picker ItemsSource="{Binding CurrentBooking.AvailableStages}"
                                    SelectedItem="{Binding CurrentBooking.SelectedStage}"
                                    TextColor="White"
                                    TitleColor="White"
                                    BackgroundColor="#0F172A"
                                    FontSize="14" />
                            
                            <Button Text="Update Status"
                                    Command="{Binding UpdateStageCommand}"
                                    BackgroundColor="#10B981"
                                    TextColor="White"
                                    CornerRadius="8"
                                    Padding="0,15"
                                    FontAttributes="Bold"
                                    FontSize="16" />
                        </VerticalStackLayout>
                    </Grid>
                </Border>

            </VerticalStackLayout>
        </ScrollView>
    </Grid>

</ContentPage>

